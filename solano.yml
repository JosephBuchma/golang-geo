# Solano CI configuration for golang-geo
golang:
  golang_version: 1.5.3

hooks:
  pre_setup: ./solano-pre_setup.sh

environment:
  'GO_ENV': 'test'

mysql:
  version: '5.5'

postgresql:
  version: '9.3'

cache:
  key_paths:
    - solano-pre_setup.sh
  save_paths:
    - bin
    - pkg
    - src
plan:
  - default
  - step1
  - step2
  - step3
  
profiles:
  default:
    tests:
      - export DB=mysql && export GOPATH=$TDDIUM_REPO_ROOT && go test
      - export DB=postgres-solano && export GOPATH=$TDDIUM_REPO_ROOT && go test # Using 'postgres-solano' because 'postgres' has db user name hardcoded
      - export DB=mock && export GOPATH=$TDDIUM_REPO_ROOT && go test
      - echo 'step1'

  step2:
    tests:
      - export DB=mysql && export GOPATH=$TDDIUM_REPO_ROOT && go test
      - export DB=postgres-solano && export GOPATH=$TDDIUM_REPO_ROOT && go test # Using 'postgres-solano' because 'postgres' has db
      - export DB=mock && export GOPATH=$TDDIUM_REPO_ROOT && go test
      - echo 'step2'
      
  step3:
    tests:
      - export DB=mysql && export GOPATH=$TDDIUM_REPO_ROOT && go test
      - export DB=postgres-solano && export GOPATH=$TDDIUM_REPO_ROOT && go test # Using 'postgres-solano' because 'postgres' has db
      - export DB=mock && export GOPATH=$TDDIUM_REPO_ROOT && go test
      - echo 'step3'
