# Solano CI configuration for golang-geo
golang:
  golang_version: 1.5.3

hooks:
  pre_setup: ./solano-pre_setup.sh

environment:
  'GO_ENV': 'test'

mysql:
  version: '5.5'

postgresql:
  version: '9.3'

cache:
  key_paths:
    - solano-pre_setup.sh
  save_paths:
    - bin
    - pkg
    - src

profiles:
  default:
    tests:
      - export DB=mysql && export GOPATH=$TDDIUM_REPO_ROOT && go test
      - export DB=postgres-solano && export GOPATH=$TDDIUM_REPO_ROOT && go test # Using 'postgres-solano' because 'postgres' has db user name hardcoded
      - export DB=mock && export GOPATH=$TDDIUM_REPO_ROOT && go test

  bundle_test:
    tests:
      - export DB=mysql && export GOPATH=$TDDIUM_REPO_ROOT && go test
      - export DB=postgres-solano && export GOPATH=$TDDIUM_REPO_ROOT && go test # Using 'postgres-solano' because 'postgres' has db
      - export DB=mock && export GOPATH=$TDDIUM_REPO_ROOT && go test
      - test `grep -c '[c]rack tar' ~/setup.log` -gt 0
  no_bundle_test:
    tests:
      - export DB=mysql && export GOPATH=$TDDIUM_REPO_ROOT && go test
      - export DB=postgres-solano && export GOPATH=$TDDIUM_REPO_ROOT && go test # Using 'postgres-solano' because 'postgres' has db
      - export DB=mock && export GOPATH=$TDDIUM_REPO_ROOT && go test
      - test `grep -c '[c]rack tar' ~/setup.log` -eq 0

  snapshot_test:
    tests:
      - export DB=mysql && export GOPATH=$TDDIUM_REPO_ROOT && go test
      - export DB=postgres-solano && export GOPATH=$TDDIUM_REPO_ROOT && go test # Using 'postgres-solano' because 'postgres' has db
      - export DB=mock && export GOPATH=$TDDIUM_REPO_ROOT && go test
      - test `grep -c '[u]npacked and verified snapshot' ~/setup.log` -gt 0
